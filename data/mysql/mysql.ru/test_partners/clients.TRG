TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`tr_BI_clients`\n        BEFORE INSERT\n        ON `clients`\n        FOR EACH ROW\nBEGIN\n	SET NEW.`rate_uah` = 20;\n	SET NEW.`rate_rub` = 45;\n	SET @deposit_correct_factor = 0;\n	SELECT `value` INTO @deposit_correct_factor FROM `global_settings` WHERE `key` = \'default_deposit_correct_factor\';\n	SET NEW.`deposit_correct_factor` = @deposit_correct_factor;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `clients_changes_before` BEFORE UPDATE ON `clients` FOR EACH ROW BEGIN\n\nIF @auth_login IS null AND (\nOLD.money_paid_in != NEW.money_paid_in\nOR OLD.money_paid_in_mgc != NEW.money_paid_in_mgc\nOR OLD.money_paid_out != NEW.money_paid_out\nOR OLD.deposit_correct_factor != NEW.deposit_correct_factor\n) THEN\n    INSERT INTO `test_partners_changes`.`null_who_change`(id, `who_change`) VALUES(null, @auth_login);\nEND IF;\n\nIF OLD.money_paid_in != NEW.money_paid_in\n    THEN SET NEW.rest_deposit = OLD.rest_deposit + (NEW.money_paid_in - OLD.money_paid_in);\nEND IF;\n\nIF OLD.`crm_status` != NEW.`crm_status` THEN\n    SET NEW.`remind_sent` = \'0000-00-00 00:00:00\';\nEND IF;\n\nIF OLD.`money_paid_in_mgc` != NEW.`money_paid_in_mgc` \n    THEN SET NEW.rest_deposit_mgc = OLD.rest_deposit_mgc + (NEW.money_paid_in_mgc - OLD.money_paid_in_mgc);\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`clients_changes` AFTER UPDATE ON `test_partners`.`clients`\n FOR EACH ROW BEGIN\n\nIF (OLD.money_paid_in_mgc != NEW.money_paid_in_mgc || (OLD.deposit_correct_factor != NEW.deposit_correct_factor && NEW.crm_status IN (3,8,11,12))) THEN\n    INSERT INTO `test_partners_changes`.`clients_deposit_log`(`id`, `client_id`, `dt`, `old_deposit`, `new_deposit`, `added`, `old_correct`, `new_correct`, `rest_deposit`, `who_add`, `comments`, `currency`)\n            VALUES(NULL , NEW.id, NOW( ) , OLD.money_paid_in_mgc * 100, NEW.money_paid_in_mgc * 100, (NEW.money_paid_in_mgc - OLD.money_paid_in_mgc) * 100, OLD.deposit_correct_factor, NEW.deposit_correct_factor, OLD.rest_deposit_mgc * 100, @auth_login, @comments, @currency);\nEND IF;\n\nIF (OLD.bonus_paid_in != NEW.bonus_paid_in) THEN\n    INSERT INTO `test_partners_changes`.`clients_bonus_log`(`id`, `client_id`, `dt`, `old_deposit`, `new_deposit`, `added`, `old_correct`, `new_correct`, `rest_deposit`, `rest_deposit_mgc`, `who_add`, `comments`, `currency`)\n            VALUES(NULL , NEW.id, NOW( ) , OLD.bonus_paid_in, NEW.bonus_paid_in, NEW.bonus_paid_in - OLD.bonus_paid_in, OLD.deposit_correct_factor, NEW.deposit_correct_factor, OLD.rest_deposit, OLD.rest_deposit_mgc, @auth_login, @comments, @currency);\nEND IF;\n\nIF (OLD.money_paid_out != NEW.money_paid_out) THEN\n    INSERT INTO `test_partners_changes`.`clients_paid_out_log`(`id`, `client_id`, `dt`, `who`, `old_paid_out`, `new_paid_out`, `amount`)\n            VALUES(NULL , NEW.id, NOW(), @auth_login, OLD.money_paid_out, NEW.money_paid_out, NEW.money_paid_out - OLD.money_paid_out);\nEND IF;\n\nIF (OLD.murdered_wages != NEW.murdered_wages) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'murdered_wages\', OLD.murdered_wages, NEW.murdered_wages, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.murdered_shows != NEW.murdered_shows) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'murdered_shows\', OLD.murdered_shows, NEW.murdered_shows, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.murdered_clicks != NEW.murdered_clicks) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'murdered_clicks\', OLD.murdered_clicks, NEW.murdered_clicks, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.penalty != NEW.penalty) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'penalty\', OLD.penalty, NEW.penalty, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.editing_news_categories != NEW.editing_news_categories) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'editing_news_categories\', OLD.editing_news_categories, NEW.editing_news_categories, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.can_pay_all_time != NEW.can_pay_all_time) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'can_pay_all_time\', OLD.can_pay_all_time, NEW.can_pay_all_time, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.tasks != NEW.tasks) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'tasks\', OLD.tasks, NEW.tasks, NOW(), @auth_login, USER());\nEND IF;\n\nIF (NOT OLD.inviter <=> NEW.inviter) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'inviter\', OLD.inviter, IF(NEW.inviter IS NOT NULL, NEW.inviter, \'\'), NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.can_see_news != NEW.can_see_news) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'can_see_news\', OLD.can_see_news, NEW.can_see_news, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.can_edit_news != NEW.can_edit_news) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'can_edit_news\', OLD.can_edit_news, NEW.can_edit_news, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.news_campaigns_limit != NEW.news_campaigns_limit) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'news_campaigns_limit\', OLD.news_campaigns_limit, NEW.news_campaigns_limit, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.credit_mgc != NEW.credit_mgc) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'credit\', OLD.credit_mgc, NEW.credit_mgc, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.credit_type != NEW.credit_type) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'credit_type\', OLD.credit_type, NEW.credit_type, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.deposit_blocked_funds != NEW.deposit_blocked_funds) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'deposit_blocked_funds\', OLD.deposit_blocked_funds, NEW.deposit_blocked_funds, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.auto_payments_enabled != NEW.auto_payments_enabled) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'auto_payments_enabled\', OLD.auto_payments_enabled, NEW.auto_payments_enabled, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.auto_payments_allowed != NEW.auto_payments_allowed) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'auto_payments_allowed\', OLD.auto_payments_allowed, NEW.auto_payments_allowed, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.goodhits_campaigns_limit != NEW.goodhits_campaigns_limit) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'goodhits_campaigns_limit\', OLD.goodhits_campaigns_limit, NEW.goodhits_campaigns_limit, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.goods_per_partner_limit != NEW.goods_per_partner_limit) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'goods_per_partner_limit\', OLD.goods_per_partner_limit, NEW.goods_per_partner_limit, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.goodhits_timeblocking_flag != NEW.goodhits_timeblocking_flag) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'goodhits_timeblocking_flag\', OLD.goodhits_timeblocking_flag, NEW.goodhits_timeblocking_flag, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.detailed_goodhits_stat != NEW.detailed_goodhits_stat) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'detailed_goodhits_stat\', OLD.detailed_goodhits_stat, NEW.detailed_goodhits_stat, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.ticker_to_site_connect_flag != NEW.ticker_to_site_connect_flag) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'ticker_to_site_connect_flag\', OLD.ticker_to_site_connect_flag, NEW.ticker_to_site_connect_flag, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.goodhits_platform_flag != NEW.goodhits_platform_flag) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'goodhits_platform_flag\', OLD.goodhits_platform_flag, NEW.goodhits_platform_flag, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.hide_wages_flag != NEW.hide_wages_flag) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'hide_wages_flag\', OLD.hide_wages_flag, NEW.hide_wages_flag, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.tails != NEW.tails) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'tails\', OLD.tails, NEW.tails, NOW(), @auth_login, USER());\nEND IF;\n\nIF (OLD.ads_correct_factor != NEW.ads_correct_factor) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'ads_correct_factor\', OLD.ads_correct_factor, NEW.ads_correct_factor, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.subnet != NEW.subnet) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'subnet\', OLD.subnet, NEW.subnet, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.white_list != NEW.white_list) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'white_list\', OLD.white_list, NEW.white_list, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.rate_uah != NEW.rate_uah) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'rate_uah\', OLD.rate_uah, NEW.rate_uah, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.rate_rub != NEW.rate_rub) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'rate_rub\', OLD.rate_rub, NEW.rate_rub, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.`status` != NEW.`status`) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'status\', OLD.`status`, NEW.`status`, NOW(), @auth_login, USER());\nEND IF;\n\nIF @auth_login IS null THEN\n    SET @auth_login := \'\';\nEND IF;\nIF (OLD.when_add != NEW.when_add) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'when_add\', OLD.when_add, NEW.when_add, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.client_from != NEW.client_from) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'client_from\', OLD.client_from, NEW.client_from, NOW(), @auth_login, USER());\nEND IF;\nIF (OLD.activation_key_update != NEW.activation_key_update) THEN\n    INSERT INTO `test_partners_changes`.`clients_changes`(`id`, `client_id`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n            VALUES(NULL , NEW.id, \'activation_key_update\', OLD.activation_key_update, NEW.activation_key_update, NOW(), @auth_login, USER());\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER test_partners.tr_BD_clients\nAFTER DELETE\nON test_partners.clients\nFOR EACH ROW\nBEGIN\n\n  IF @auth_login IS NULL THEN\n    INSERT INTO `test_partners_changes`.`null_who_change` (id, `who_change`)\n      VALUES (NULL, @auth_login);\n  END IF;\n\n  INSERT INTO `test_partners_changes`.`clients_delete` (`client_id`, `who`, `when`, `mysql_user`, `crm_status`)\n    VALUES (OLD.id, @auth_login, NOW(), USER(), OLD.crm_status);\n\nEND'
sql_modes=1342177280 1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8' 'utf8mb4' 'utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8mb4_unicode_ci' 'utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
created=153375877570 153375877576 153375877577 153375877578
