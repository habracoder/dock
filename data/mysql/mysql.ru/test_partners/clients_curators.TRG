TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`curator_add` AFTER INSERT ON `test_partners`.`clients_curators`\nFOR EACH ROW BEGIN \n\nSET @who_login = IF(@auth_login IS NOT NULL AND @auth_login != \'\', @auth_login, \'unknown\');\n\n\nINSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `client_id`, `section`, `field`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n  VALUES(NULL , NEW.client_id, NEW.section, \'curator\', \'\', NEW.curator, NOW(), @who_login, USER());\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`clients_curators_changes` AFTER UPDATE ON `test_partners`.`clients_curators`\n FOR EACH ROW BEGIN\n\n  IF (OLD.curator != NEW.curator) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'curator\', NEW.client_id, NEW.section, OLD.curator, NEW.curator, NOW(), @auth_login, USER());\n\n    UPDATE `test_partners`.`clients` SET when_change=NOW() WHERE `id` = NEW.client_id;\n  END IF;\n\n  IF (OLD.client_refused != NEW.client_refused) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'client_refused\', NEW.client_id, NEW.section, OLD.client_refused, NEW.client_refused, NOW(), @auth_login, USER());\n  END IF;\n\n\n  IF (NOT OLD.client_refused_when <=> NEW.client_refused_when) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'client_refused_when\', NEW.client_id, NEW.section, IF(OLD.client_refused_when IS NOT NULL, OLD.client_refused_when, \'\'), IF(NEW.client_refused_when IS NOT NULL, NEW.client_refused_when, \'\'), NOW(), @auth_login, USER());\n  END IF;\n\n  IF (NOT OLD.client_refused_until <=> NEW.client_refused_until) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'client_refused_until\', NEW.client_id, NEW.section, IF(OLD.client_refused_until IS NOT NULL, OLD.client_refused_until, \'\'), IF(NEW.client_refused_until IS NOT NULL, NEW.client_refused_until, \'\'), NOW(), @auth_login, USER());\n  END IF;\n\n  IF (NOT OLD.client_refused_who <=> NEW.client_refused_who) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'client_refused_who\', NEW.client_id, NEW.section, IF(OLD.client_refused_who IS NOT NULL, OLD.client_refused_who, \'\'), IF(NEW.client_refused_who IS NOT NULL, NEW.client_refused_who, \'\'), NOW(), @auth_login, USER());\n  END IF;\n\n  IF (NOT OLD.client_refused_why <=> NEW.client_refused_why) THEN\n    INSERT INTO `test_partners_changes`.`clients_curators_changes`(`id`, `field`, `client_id`, `section`, `old_value`, `new_value`, `when`, `who`, `mysql_user`)\n      VALUES(NULL, \'client_refused_why\', NEW.client_id, NEW.section, IF(OLD.client_refused_why IS NOT NULL, OLD.client_refused_why, \'\'), IF(NEW.client_refused_why IS NOT NULL, NEW.client_refused_why, \'\'), NOW(), @auth_login, USER());\n  END IF;\n\nEND'
sql_modes=1342177280 1342177280
definers='root@localhost' 'root@localhost'
client_cs_names='utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci'
created=153375877582 153375877583
