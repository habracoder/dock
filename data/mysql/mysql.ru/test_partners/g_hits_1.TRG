TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`goodhits_add` AFTER INSERT ON `test_partners`.`g_hits_1`\nFOR EACH ROW BEGIN \n\nSET @who_add = IF(NEW.who_add != \'\', NEW.who_add, \'unknown\');\nIF @no_save_history IS null THEN\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `complex_change`, `who`, `field`, `when`) VALUES(NEW.id, 1, @who_add, \'create\', NOW());\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'url\', \'\', NOW(), SUBSTRING(NEW.url, 1, 255));\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'title\', \'\', NOW(), NEW.title);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'currencyid\', \'\', NOW(), NEW.currencyid);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'id_category\', \'\', NOW(), NEW.id_category);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'image_link\', \'\', NOW(), SUBSTRING(NEW.image_link, 1, 255));\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'advert_text\', \'\', NOW(), NEW.advert_text);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'blocked\', \'\', NOW(), NEW.blocked);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'blocked_reason\', \'\', NOW(), NEW.blocked_reason);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'droped\', \'\', NOW(), NEW.droped);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'karantin\', \'\', NOW(), NEW.karantin);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'ad_types\', \'\', NOW(), NEW.ad_types);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'ad_livetime\', \'\', NOW(), NEW.ad_livetime);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'female_teaser\', \'\', NOW(), NEW.female_teaser);\nINSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`) VALUES(NEW.id, @who_add, \'optimized_mobile\', \'\', NOW(), NEW.optimized_mobile);\nEND IF;\n\nINSERT INTO g_hits_1_statistics (id, price_of_click_0, price_of_click_1, price_of_click_2, price_of_click_3, price_of_click_4, price_of_click_5, price_of_click_6, price_of_click_7, price_of_click_8, price_of_click_9, price_of_click_10, price_of_click_11, price_of_click_12, price_of_click_13, price_of_click_14, price_of_click_15, price_of_click_16, price_of_click_17, price_of_click_18, price_of_click_19, price_of_click_20, price_of_click_21, price_of_click_22, price_of_click_23, price_of_click_24, price_of_click_25, price_of_click_26, price_of_click_27, price_of_click_28, price_of_click_29)\nVALUES(NEW.id, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click, NEW.price_of_click);\n\nIF NEW.is_img != 0 THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_add, \'is_img\', \'insertWithIs_img!=0\', NOW(), NEW.is_img);\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`g_hits_1_changes_before` BEFORE UPDATE ON `test_partners`.`g_hits_1`\nFOR EACH ROW BEGIN\n\nIF OLD.`title` != NEW.`title` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`url` != NEW.`url` THEN\n    SET NEW.`url_updated` = NOW();\nEND IF;\n\nIF OLD.`advert_text` != NEW.`advert_text` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`id_category` <=> NEW.`id_category` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`is_img` != NEW.`is_img` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`animation` != NEW.`animation` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`domain` != NEW.`domain` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`is_del` != NEW.`is_del` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`currencyid` <=> NEW.`currencyid` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`price` != NEW.`price` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`price_old` != NEW.`price_old` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`id_partner` <=> NEW.`id_partner` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`ad_types` <=> NEW.`ad_types` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`landing_types` <=> NEW.`landing_types` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`droped` != NEW.`droped` THEN\n    SET NEW.`updated_time` = NOW();\n    SET NEW.`when_change` = NOW();\nEND IF;\n\nIF OLD.`blocked` != NEW.`blocked` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF NOT OLD.`blocked_reason` <=> NEW.`blocked_reason` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`karantin` != NEW.`karantin` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`url` != NEW.`url` THEN\n    SET NEW.`url_updated` = NOW();\nEND IF;\n\nIF OLD.`female_teaser` != NEW.`female_teaser` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nIF OLD.`optimized_mobile` != NEW.`optimized_mobile` THEN\n    SET NEW.`updated_time` = NOW();\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`tr_goodhits_changes` AFTER UPDATE ON `g_hits_1`\nFOR EACH ROW\nBEGIN\n\nIF @who_change = \'cronExchangeParser\' ||  @who_change = \'system_auth_new_parse-exchange-ua\' || @who_change = \'system_auth_new_parse-exchange-ru\' || @who_change = \'system_auth_new_parse-exchange-lentainform\' || @who_change = \'system_auth_new_parse-exchange-other\' || @who_change = \'system_auth_new_parse-exchange-76380\' THEN\n    SET @no_save_history = TRUE;\nEND IF;\n\nIF @no_save_history IS null THEN\n\nIF @auth_login IS NULL OR @auth_login = \'\' THEN\n    SET @who_change = IF(NEW.who_change != \'\', NEW.who_change, IF(NEW.who_first_edit_after_cron != \'\', NEW.who_first_edit_after_cron, \'unknown\'));\nELSE\n    SET @who_change := @auth_login;\nEND IF;\n\nIF OLD.url != NEW.url THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'url\', SUBSTRING(OLD.url, 1, 255), NOW(), SUBSTRING(NEW.url, 1, 255));\nEND IF;\nIF BINARY OLD.title != NEW.title THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'title\', OLD.title, NOW(), NEW.title);\nEND IF;\nIF OLD.price != NEW.price AND @no_save_history IS null THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'price\', OLD.price, NOW(), NEW.price);\nEND IF;\nIF NOT (OLD.currencyid <=> NEW.currencyid) THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'currencyid\', OLD.currencyid, NOW(), NEW.currencyid);\nEND IF;\nIF NOT OLD.id_category <=> NEW.id_category THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'id_category\', OLD.id_category, NOW(), NEW.id_category);\nEND IF;\nIF OLD.image_link != NEW.image_link THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'image_link\', SUBSTRING(OLD.image_link, 1, 255), NOW(), SUBSTRING(NEW.image_link, 1, 255));\nEND IF;\nIF BINARY OLD.advert_text != NEW.advert_text THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'advert_text\', OLD.advert_text, NOW(), NEW.advert_text);\nEND IF;\nIF OLD.blocked != NEW.blocked THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'blocked\', OLD.blocked, NOW(), NEW.blocked);\nEND IF;\nIF NOT OLD.blocked_reason <=> NEW.blocked_reason THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'blocked_reason\', OLD.blocked_reason, NOW(), NEW.blocked_reason);\nEND IF;\nIF OLD.droped != NEW.droped THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'droped\', OLD.droped, NOW(), NEW.droped);\nEND IF;\nIF OLD.karantin != NEW.karantin THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'karantin\', OLD.karantin, NOW(), NEW.karantin);\nEND IF;\nIF NOT OLD.delete_reason <=> NEW.delete_reason THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'delete_reason\', OLD.delete_reason, NOW(), NEW.delete_reason);\nEND IF;\nIF NOT OLD.ad_types <=> NEW.ad_types THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'ad_types\', OLD.ad_types, NOW(), NEW.ad_types);\nEND IF;\nIF NOT (OLD.ad_livetime <=> NEW.ad_livetime) THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'ad_livetime\', OLD.ad_livetime, NOW(), NEW.ad_livetime);\nEND IF;\nIF OLD.is_img != NEW.is_img THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'is_img\', OLD.is_img, NOW(), NEW.is_img);\nEND IF;\nIF OLD.when_last_image_change != NEW.when_last_image_change THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'when_last_image_change\', OLD.when_last_image_change, NOW(), NEW.when_last_image_change);\nEND IF;\nIF OLD.img_size != NEW.img_size AND @no_save_history IS null THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'img_size\', OLD.img_size, NOW(), NEW.img_size);\nEND IF;\nIF OLD.female_teaser != NEW.female_teaser THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'female_teaser\', OLD.female_teaser, NOW(), NEW.female_teaser);\nEND IF;\nIF OLD.optimized_mobile != NEW.optimized_mobile THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'optimized_mobile\', OLD.optimized_mobile, NOW(), NEW.optimized_mobile);\nEND IF;\nIF OLD.when_last_image_change != NEW.when_last_image_change THEN\n    INSERT INTO `test_partners_changes`.`g_hits_1_changes`(`hit_id`, `who`, `field`, `old_value`, `when`, `new_value`)\n        VALUES(NEW.id, @who_change, \'when_last_image_change\', OLD.when_last_image_change, NOW(), NEW.when_last_image_change);\nEND IF;\n\nEND IF;\n\nEND'
sql_modes=1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8' 'utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
created=153375877611 153375877612 153375877613
