TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `test_partners`.`partners_1_intervals_changes_before` BEFORE UPDATE ON `test_partners`.`partners_1_intervals`\nFOR EACH ROW BEGIN\n\nIF OLD.client_site_id != 0 AND NEW.client_site_id = 0\nTHEN\n    INSERT INTO `test_partners_changes`.`null_who_change`(id, `who_change`) VALUES(NULL, @auth_login);\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `partners_1_intervals_changes` AFTER UPDATE ON `partners_1_intervals`\n FOR EACH ROW BEGIN\n\nIF @auth_login IS null THEN\n    INSERT INTO `test_partners_changes`.`null_who_change`(id, `who_change`) VALUES(null, @auth_login);\nEND IF;\n\nIF OLD.price != NEW.price THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'price\', OLD.price, NOW(), NEW.price, USER());\nEND IF;\nIF OLD.clickbuyer_howmany != NEW.clickbuyer_howmany THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'clickbuyer_howmany\', OLD.clickbuyer_howmany, NOW(), NEW.clickbuyer_howmany, USER());\nEND IF;\nIF OLD.clickbuyer_howmany_weekend != NEW.clickbuyer_howmany_weekend THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'clickbuyer_howmany_weekend\', OLD.clickbuyer_howmany_weekend, NOW(), NEW.clickbuyer_howmany_weekend, USER());\nEND IF;\nIF OLD.clickbuyer_howmany_first != NEW.clickbuyer_howmany_first THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'clickbuyer_howmany_first\', OLD.clickbuyer_howmany_first, NOW(), NEW.clickbuyer_howmany_first, USER());\nEND IF;\nIF OLD.price_first != NEW.price_first THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'price_first\', OLD.price_first, NOW(), NEW.price_first, USER());\nEND IF;\nIF OLD.weekday != NEW.weekday THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'weekday\', OLD.weekday, NOW(), NEW.weekday, USER());\nEND IF;\nIF OLD.holiday != NEW.holiday THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'holiday\', OLD.holiday, NOW(), NEW.holiday, USER());\nEND IF;\nIF OLD.start != NEW.start THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'start\', OLD.start, NOW(), NEW.start, USER());\nEND IF;\nIF NOT OLD.`end` <=> NEW.`end` THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'end\', IF(OLD.`end` IS NULL, \'\', OLD.`end`), NOW(), IF(NEW.`end` IS NULL, \'\', NEW.`end`), USER());\nEND IF;\nIF OLD.`comment` != NEW.`comment` THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'comment\', OLD.`comment`, NOW(), NEW.`comment`, USER());\nEND IF;\nIF OLD.`status` != NEW.`status` THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'status\', OLD.`status`, NOW(), NEW.`status`, USER());\nEND IF;\nIF OLD.`clickbuyer_unique` != NEW.`clickbuyer_unique` THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(NEW.id, @auth_login, \'clickbuyer_unique\', OLD.`clickbuyer_unique`, NOW(), NEW.`clickbuyer_unique`, USER());\nEND IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `partners_1_intervals_delete_check` BEFORE DELETE ON `partners_1_intervals`\n FOR EACH ROW BEGIN\n\nIF @auth_login IS null THEN\n    INSERT INTO `test_partners_changes`.`null_who_change`(id, `who_change`) VALUES(null, @auth_login);\nEND IF;\n\nIF (LENGTH(@key) > 0) THEN\n    INSERT INTO `test_partners_changes`.`partners_1_intervals_changes`(`interval_id`, `who`, `field`, `old_value`, `when`, `new_value`, `mysql_user`)\n        VALUES(OLD.id, @auth_login, \'delete_row\', @key, NOW(), \'\', USER());\nELSE\n    INSERT INTO `test_partners_changes`.`partners_1_changes`(`invalid_key`) VALUES(\'access_denied\');\nEND IF;\n\nIF @test IS NULL THEN\n    SET @key = \'\';\nEND IF;\n\nEND'
sql_modes=0 1342177280 0
definers='root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8' 'utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
created=153375877654 153375877655 153375877657
